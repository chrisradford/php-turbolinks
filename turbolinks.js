var CSRFToken,anchoredLink,browserCompatibleDocumentParser,browserIsntBuggy,browserSupportsPushState,cacheCurrentPage,changePage,constrainPageCacheTo,createDocument,crossOriginLink,currentState,executeScriptTags,extractLink,extractTitleAndBody,fetchHistory,fetchReplacement,handleClick,ignoreClick,initializeTurbolinks,initialized,installClickHandlerLast,loadedAssets,noTurbolink,nonHtmlLink,nonStandardClick,pageCache,recallScrollPosition,referer,reflectNewUrl,reflectRedirectedUrl,rememberCurrentState,rememberCurrentUrl,rememberInitialPage,removeHash,removeNoscriptTags,requestMethod,requestMethodIsSafe,resetScrollPosition,targetLink,triggerEvent,validateResponse,visit,xhr,_ref,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};initialized=false;currentState=null;referer=document.location.href;loadedAssets=null;pageCache={};createDocument=null;requestMethod=((_ref=document.cookie.match(/request_method=(\w+)/))!=null?_ref[1].toUpperCase():void 0)||"";xhr=null;visit=function(e){if(browserSupportsPushState&&browserIsntBuggy){cacheCurrentPage();reflectNewUrl(e);return fetchReplacement(e)}else{return document.location.href=e}};fetchReplacement=function(e){var t;triggerEvent("page:fetch");t=removeHash(e);if(xhr!=null){xhr.abort()}xhr=new XMLHttpRequest;xhr.open("GET",t,true);xhr.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml");xhr.setRequestHeader("X-XHR-Referer",referer);xhr.onload=function(){var e;triggerEvent("page:receive");if(e=validateResponse()){changePage.apply(null,extractTitleAndBody(e));reflectRedirectedUrl();if(document.location.hash){document.location.href=document.location.href}else{resetScrollPosition()}return triggerEvent("page:load")}};xhr.onloadend=function(){return xhr=null};xhr.onabort=function(){return rememberCurrentUrl()};xhr.onerror=function(){return document.location.href=e};return xhr.send()};fetchHistory=function(e){var t;cacheCurrentPage();if(t=pageCache[e.position]){if(xhr!=null){xhr.abort()}changePage(t.title,t.body);recallScrollPosition(t);return triggerEvent("page:restore")}else{return fetchReplacement(document.location.href)}};cacheCurrentPage=function(){rememberInitialPage();pageCache[currentState.position]={url:document.location.href,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset};return constrainPageCacheTo(10)};constrainPageCacheTo=function(e){var t,n;for(t in pageCache){if(!__hasProp.call(pageCache,t))continue;n=pageCache[t];if(t<=currentState.position-e){pageCache[t]=null}}};changePage=function(e,t,n,r){document.title=e;document.documentElement.replaceChild(t,document.body);if(n!=null){CSRFToken.update(n)}removeNoscriptTags();if(r){executeScriptTags()}currentState=window.history.state;return triggerEvent("page:change")};executeScriptTags=function(){var e,t,n,r,i,s,o,u,a,f,l,c;s=Array.prototype.slice.call(document.body.querySelectorAll('script:not([data-turbolinks-eval="false"])'));for(o=0,a=s.length;o<a;o++){i=s[o];if(!((l=i.type)===""||l==="text/javascript")){continue}t=document.createElement("script");c=i.attributes;for(u=0,f=c.length;u<f;u++){e=c[u];t.setAttribute(e.name,e.value)}t.appendChild(document.createTextNode(i.innerHTML));r=i.parentNode,n=i.nextSibling;r.removeChild(i);r.insertBefore(t,n)}};removeNoscriptTags=function(){var e,t,n,r;t=Array.prototype.slice.call(document.body.getElementsByTagName("noscript"));for(n=0,r=t.length;n<r;n++){e=t[n];e.parentNode.removeChild(e)}};reflectNewUrl=function(e){if(e!==document.location.href){referer=document.location.href;return window.history.pushState({turbolinks:true,position:currentState.position+1},"",e)}};reflectRedirectedUrl=function(){var e,t;if(e=xhr.getResponseHeader("X-XHR-Redirected-To")){t=removeHash(e)===e?document.location.hash:"";return window.history.replaceState(currentState,"",e+t)}};rememberCurrentUrl=function(){return window.history.replaceState({turbolinks:true,position:Date.now()},"",document.location.href)};rememberCurrentState=function(){return currentState=window.history.state};rememberInitialPage=function(){if(!initialized){rememberCurrentUrl();rememberCurrentState();createDocument=browserCompatibleDocumentParser();return initialized=true}};recallScrollPosition=function(e){return window.scrollTo(e.positionX,e.positionY)};resetScrollPosition=function(){return window.scrollTo(0,0)};removeHash=function(e){var t;t=e;if(e.href==null){t=document.createElement("A");t.href=e}return t.href.replace(t.hash,"")};triggerEvent=function(e){var t;t=document.createEvent("Events");t.initEvent(e,true,true);return document.dispatchEvent(t)};validateResponse=function(){var e,t,n,r,i,s,o;t=function(){return xhr.status.toString().match(/^4/)};s=function(){return!xhr.getResponseHeader("Content-Type").match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/)};r=function(e){var t,n,r,i,s;i=e.head.childNodes;s=[];for(n=0,r=i.length;n<r;n++){t=i[n];if((typeof t.getAttribute==="function"?t.getAttribute("data-turbolinks-track"):void 0)!=null){s.push(t.src||t.href)}}return s};e=function(e){var t;loadedAssets||(loadedAssets=r(document));t=r(e);return t.length!==loadedAssets.length||i(t,loadedAssets).length!==loadedAssets.length};i=function(e,t){var n,r,i,s,o;if(e.length>t.length){s=[t,e],e=s[0],t=s[1]}o=[];for(r=0,i=e.length;r<i;r++){n=e[r];if(__indexOf.call(t,n)>=0){o.push(n)}}return o};if(t()){o=document.location.href;window.history.replaceState(null,"","#");window.location.replace(o);return false}else if(s()||e(n=createDocument(xhr.responseText))){window.location.reload();return false}else{return n}};extractTitleAndBody=function(e){var t;t=e.querySelector("title");return[t!=null?t.textContent:void 0,e.body,CSRFToken.get(e).token,"runScripts"]};CSRFToken={get:function(e){var t;if(e==null){e=document}return{node:t=e.querySelector('meta[name="csrf-token"]'),token:t!=null?typeof t.getAttribute==="function"?t.getAttribute("content"):void 0:void 0}},update:function(e){var t;t=this.get();if(t.token!=null&&e!=null&&t.token!==e){return t.node.setAttribute("content",e)}}};browserCompatibleDocumentParser=function(){var e,t,n,r,i;t=function(e){return(new DOMParser).parseFromString(e,"text/html")};e=function(e){var t;t=document.implementation.createHTMLDocument("");t.documentElement.innerHTML=e;return t};n=function(e){var t;t=document.implementation.createHTMLDocument("");t.open("replace");t.write(e);t.close();return t};try{if(window.DOMParser){r=t("<html><body><p>test");return t}}catch(s){r=e("<html><body><p>test");return e}finally{if((r!=null?(i=r.body)!=null?i.childNodes.length:void 0:void 0)!==1){return n}}};installClickHandlerLast=function(e){if(!e.defaultPrevented){document.removeEventListener("click",handleClick,false);return document.addEventListener("click",handleClick,false)}};handleClick=function(e){var t;if(!e.defaultPrevented){t=extractLink(e);if(t.nodeName==="A"&&!ignoreClick(e,t)){visit(t.href);return e.preventDefault()}}};extractLink=function(e){var t;t=e.target;while(!(!t.parentNode||t.nodeName==="A")){t=t.parentNode}return t};crossOriginLink=function(e){return location.protocol!==e.protocol||location.host!==e.host};anchoredLink=function(e){return(e.hash&&removeHash(e))===removeHash(location)||e.href===location.href+"#"};nonHtmlLink=function(e){var t;t=removeHash(e);return t.match(/\.[a-z]+(\?.*)?$/g)&&!t.match(/\.html?(\?.*)?$/g)};noTurbolink=function(e){var t;while(!(t||e===document)){t=e.getAttribute("data-no-turbolink")!=null;e=e.parentNode}return t};targetLink=function(e){return e.target.length!==0};nonStandardClick=function(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey};ignoreClick=function(e,t){return crossOriginLink(t)||anchoredLink(t)||nonHtmlLink(t)||noTurbolink(t)||targetLink(t)||nonStandardClick(e)};initializeTurbolinks=function(){document.addEventListener("click",installClickHandlerLast,true);return window.addEventListener("popstate",function(e){var t;if((t=e.state)!=null?t.turbolinks:void 0){return fetchHistory(e.state)}},false)};browserSupportsPushState=window.history&&window.history.pushState&&window.history.replaceState&&window.history.state!==void 0;browserIsntBuggy=!navigator.userAgent.match(/CriOS\//);requestMethodIsSafe=requestMethod==="GET"||requestMethod==="";if(browserSupportsPushState&&browserIsntBuggy&&requestMethodIsSafe){initializeTurbolinks()}this.Turbolinks={visit:visit}